<%- include('../partials/header') %>

<div class="dashboard-wrapper">
    <!-- HANYA TAMPILKAN NAVBAR JIKA USER SUDAH LOGIN -->
    <% if (currentUser) { %>
        <%- include('../partials/navbar') %>
    <% } %>

    <main class="main-content" style="<%= currentUser ? '' : 'margin-left:0; width:100%;' %>">
        <header class="top-header">
            <div style="display:flex;align-items:center;">
                <!-- Hamburger hanya muncul jika login -->
                <% if (currentUser) { %>
                    <button id="sidebarCollapse" class="hamburger"><i class="fa-solid fa-bars"></i></button>
                <% } else { %>
                    <a href="/marketplace" class="btn-primary" style="width:auto; padding:5px 10px; margin-right:15px;">
                        <i class="fa-solid fa-arrow-left"></i>
                    </a>
                <% } %>
                <div class="breadcrumb"><h2>Etalase Toko</h2></div>
            </div>
            <% if (currentUser) { %>
                <div class="balance-card">Rp <%= (currentUser.balance || 0).toLocaleString('id-ID') %></div>
            <% } %>
        </header>

        <div class="content-card" style="margin-bottom:30px; background:linear-gradient(45deg, #1e293b, #0f172a);">
            <div class="card-body" style="display:flex; align-items:center; gap:20px;">
                <img src="<%= seller.profile_pic %>" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--neon-blue);">
                <div>
                    <h2 style="font-size:24px; margin:0;"><%= seller.fullname %></h2>
                    <p style="color:var(--text-muted);">@<%= seller.username %></p>
                    <div style="margin-top:10px; display:flex; gap:10px;">
                        <span class="badge bg-info">Seller Terverifikasi</span>
                        <% if(currentUser && currentUser.id !== seller._id.toString()) { %>
                            <a href="/chat/<%= seller._id %>" class="badge bg-secondary" style="text-decoration:none;"><i class="fa-solid fa-envelope"></i> Kirim Pesan</a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <h3 style="margin-bottom:20px;">Produk dari <%= seller.username %></h3>
        <div class="mp-grid">
            <% products.forEach(prod => { %>
                <div class="mp-card" style="position: relative;">
                    <% if(currentUser && (currentUser.id === seller._id.toString() || currentUser.role === 'admin')) { %>
                        <div style="position: absolute; top: 10px; right: 10px; z-index: 10; display: flex; gap: 5px;">
                            <a href="/marketplace/edit/<%= prod._id %>" class="badge bg-warning text-dark"><i class="fa-solid fa-pen"></i> Edit</a>
                            <a href="/marketplace/delete/<%= prod._id %>" class="badge bg-danger text-white" onclick="return confirm('Hapus?')"><i class="fa-solid fa-trash"></i></a>
                        </div>
                    <% } %>
                    <a href="/marketplace/product/<%= prod.slug %>"><img src="<%= prod.image %>" class="mp-img"></a>
                    <div class="mp-details">
                        <div class="mp-title"><%= prod.name %></div>
                        <span class="mp-price">Rp <%= prod.price.toLocaleString('id-ID') %></span>
                    </div>
                </div>
            <% }) %>
        </div>
    </main>
</div>
<%- include('../partials/footer') %>