<%- include('../partials/header') %>
<div class="dashboard-wrapper">
    <%- include('../partials/navbar') %>
    <main class="main-content" style="display:flex; flex-direction:column; height:100vh;">
        <header class="top-header" style="flex-shrink:0;">
            <div style="display:flex;align-items:center; gap:10px;">
                <a href="/chat" style="color:white;"><i class="fa-solid fa-arrow-left"></i></a>
                <img src="<%= partner.profile_pic %>" style="width:35px; height:35px; border-radius:50%;">
                <div>
                    <div style="font-weight:600; font-size:14px;"><%= partner.username %></div>
                    <div style="font-size:11px; color:#34d399;">Online</div>
                </div>
            </div>
        </header>

        <div class="content-card" style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
            <div class="card-body" style="flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:15px;" id="chatContainer">
                <% messages.forEach(msg => { %>
                    <div style="display:flex; justify-content: <%= msg.sender.toString() === userId ? 'flex-end' : 'flex-start' %>;">
                        <div style="max-width:70%; background: <%= msg.sender.toString() === userId ? 'var(--neon-blue)' : 'var(--glass-border)' %>; padding:10px 15px; border-radius:15px; font-size:14px; color:white;">
                            <%= msg.message %>
                            <div style="font-size:10px; text-align:right; opacity:0.7; margin-top:5px;">
                                <%= moment(msg.createdAt).format('HH:mm') %>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
            <div style="padding:15px; background:var(--glass-bg); border-top:1px solid var(--glass-border);">
                <form action="/chat/send" method="POST" style="display:flex; gap:10px;">
                    <input type="hidden" name="receiverId" value="<%= partner._id %>">
                    <input type="text" name="message" class="form-control" placeholder="Tulis pesan..." required autocomplete="off" style="border-radius:20px;">
                    <button class="btn-primary" style="width:auto; border-radius:50%; width:45px; height:45px; display:flex; align-items:center; justify-content:center;">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </main>
</div>
<script>
    const container = document.getElementById('chatContainer');
    container.scrollTop = container.scrollHeight;
</script>
<%- include('../partials/footer') %>